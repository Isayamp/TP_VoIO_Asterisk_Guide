; ======= fichier: /etc/asterisk/pjsip.conf =========
; Configuration des utilisateurs SIP avec support Audio + Vidéo

; à coller en dessous de tout dans le fichier pjsip.conf



; ===============================
; Transport SIP UDP principal
; ===============================
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060         ; Écoute sur toutes les interfaces IP au port 5060


; ===============================
; Utilisateur SIP n°1 (poste 7001)
; Support Audio + Vidéo
; ===============================

[7001]                    ; Identifiant de l'utilisateur (Endpoint)
type=endpoint             ; Déclare un "endpoint" SIP (un terminal)
context=from-internal     ; Contexte d'appel (doit correspondre à extensions.conf)
disallow=all              ; On désactive tous les codecs par défaut
; === CODECS AUDIO ===
allow=ulaw                ; G.711 µ-law (64 kbit/s, haute qualité, standard téléphonie)
allow=alaw                ; G.711 A-law (alternative européenne au µ-law)
allow=g722                ; G.722 (64 kbit/s, meilleure qualité que G.711)
; === CODECS VIDÉO ===
allow=h264                ; H.264/AVC (standard vidéo moderne, efficace)
allow=vp8                 ; VP8 (codec libre Google, compatible WebRTC)
allow=h263                ; H.263 (codec vidéo plus ancien, fallback)
; === PARAMÈTRES VIDÉO ===
max_video_streams=1       ; Nombre maximum de flux vidéo simultanés
max_audio_streams=1       ; Nombre maximum de flux audio simultanés
auth=auth7001             ; Référence à la section auth de cet utilisateur
aors=7001                 ; Référence à l'AOR (Address Of Record = où joindre ce client)

[auth7001]                ; Authentification pour 7001
type=auth
auth_type=userpass        ; Auth type = username/password
username=7001             ; Username SIP (login à mettre dans le softphone)
password=motdepasse1      ; Mot de passe SIP (CHANGEZ-LE pour la sécurité)

[7001]                    ; Adresse où joindre l'utilisateur 7001
type=aor
max_contacts=1            ; Maximum de périphériques enregistrés simultanément
qualify_frequency=60      ; Vérification de présence toutes les 60 secondes


; ===============================
; Utilisateur SIP n°2 (poste 7002)
; Support Audio + Vidéo
; ===============================

[7002]
type=endpoint
context=from-internal
disallow=all
; === CODECS AUDIO ===
allow=ulaw                ; G.711 µ-law (codec principal)
allow=alaw                ; G.711 A-law (fallback)
allow=g722                ; G.722 (haute qualité audio)
; === CODECS VIDÉO ===
allow=h264                ; H.264/AVC (vidéo principale)
allow=vp8                 ; VP8 (vidéo WebRTC)
allow=h263                ; H.263 (vidéo fallback)
; === PARAMÈTRES VIDÉO ===
max_video_streams=1       ; Un flux vidéo max
max_audio_streams=1       ; Un flux audio max
auth=auth7002
aors=7002

[auth7002]                ; Authentification pour 7002
type=auth
auth_type=userpass
username=7002
password=motdepasse2      ; CHANGEZ ce mot de passe

[7002]                    ; AOR pour 7002
type=aor
max_contacts=1
qualify_frequency=60


; ===============================
; Utilisateur SIP n°3 (poste 7003)
; Support Audio + Vidéo
; ===============================

[7003]
type=endpoint
context=from-internal
disallow=all
; === CODECS AUDIO ===
allow=ulaw                ; G.711 µ-law
allow=alaw                ; G.711 A-law
allow=g722                ; G.722 haute qualité
; === CODECS VIDÉO ===
allow=h264                ; H.264/AVC
allow=vp8                 ; VP8
allow=h263                ; H.263
; === PARAMÈTRES VIDÉO ===
max_video_streams=1       ; Un flux vidéo max
max_audio_streams=1       ; Un flux audio max
auth=auth7003
aors=7003

[auth7003]                ; Authentification pour 7003
type=auth
auth_type=userpass
username=7003
password=motdepasse3      ; CHANGEZ ce mot de passe

[7003]                    ; AOR pour 7003
type=aor
max_contacts=1
qualify_frequency=60


; ===============================
; NOTES IMPORTANTES
; ===============================
; 1. Codecs vidéo supportés par Asterisk :
;    - H.264 : Standard moderne, efficace, supporté par la plupart des clients
;    - VP8 : Codec libre, compatible WebRTC
;    - H.263 : Plus ancien, utilisé comme fallback
;
; 2. Pour tester la vidéo :
;    - Les deux softphones doivent supporter le même codec vidéo
;    - Vérifier que les ports RTP sont ouverts (10000-20000/UDP)
;    - Activer la caméra dans le softphone pendant l'appel
;
; 3. Commandes de vérification :
;    - pjsip show endpoints
;    - core show video codecs
;    - rtp show stats
;
; 4. Sécurité :
;    - Changez tous les mots de passe par défaut
;    - Limitez l'accès réseau si nécessaire
;    - Surveillez les logs pour tentatives d'intrusion
; ======= fichier: /etc/asterisk/pjsip.conf =============



; ===============================
; Transport SIP UDP principal
; ===============================
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060         ; Écoute sur toutes les interfaces IP au port 5060


; ===============================
; Utilisateur SIP n°1 (poste 7001)
; Support Audio + Vidéo
; ===============================

[7001]                    ; Identifiant de l'utilisateur (Endpoint)
type=endpoint             ; Déclare un "endpoint" SIP (un terminal)
context=from-internal     ; Contexte d'appel (doit correspondre à extensions.conf)
disallow=all              ; On désactive tous les codecs par défaut
; === CODECS AUDIO ===
allow=ulaw                ; G.711 µ-law (64 kbit/s, haute qualité, standard téléphonie)
allow=alaw                ; G.711 A-law (alternative européenne au µ-law)
allow=g722                ; G.722 (64 kbit/s, meilleure qualité que G.711)
; === CODECS VIDÉO ===
allow=h264                ; H.264/AVC (standard vidéo moderne, efficace)
allow=vp8                 ; VP8 (codec libre Google, compatible WebRTC)
allow=h263                ; H.263 (codec vidéo plus ancien, fallback)
; === PARAMÈTRES VIDÉO ===
max_video_streams=1       ; Nombre maximum de flux vidéo simultanés
max_audio_streams=1       ; Nombre maximum de flux audio simultanés
auth=auth7001             ; Référence à la section auth de cet utilisateur
aors=7001                 ; Référence à l'AOR (Address Of Record = où joindre ce client)

[auth7001]                ; Authentification pour 7001
type=auth
auth_type=userpass        ; Auth type = username/password
username=7001             ; Username SIP (login à mettre dans le softphone)
password=motdepasse1      ; Mot de passe SIP (CHANGEZ-LE pour la sécurité)

[7001]                    ; Adresse où joindre l'utilisateur 7001
type=aor
max_contacts=1            ; Maximum de périphériques enregistrés simultanément
qualify_frequency=60      ; Vérification de présence toutes les 60 secondes


; ===============================
; Utilisateur SIP n°2 (poste 7002)
; Support Audio + Vidéo
; ===============================

[7002]
type=endpoint
context=from-internal
disallow=all
; === CODECS AUDIO ===
allow=ulaw                ; G.711 µ-law (codec principal)
allow=alaw                ; G.711 A-law (fallback)
allow=g722                ; G.722 (haute qualité audio)
; === CODECS VIDÉO ===
allow=h264                ; H.264/AVC (vidéo principale)
allow=vp8                 ; VP8 (vidéo WebRTC)
allow=h263                ; H.263 (vidéo fallback)
; === PARAMÈTRES VIDÉO ===
max_video_streams=1       ; Un flux vidéo max
max_audio_streams=1       ; Un flux audio max
auth=auth7002
aors=7002

[auth7002]                ; Authentification pour 7002
type=auth
auth_type=userpass
username=7002
password=motdepasse2      ; CHANGEZ ce mot de passe

[7002]                    ; AOR pour 7002
type=aor
max_contacts=1
qualify_frequency=60


; ===============================
; Utilisateur SIP n°3 (poste 7003)
; Support Audio + Vidéo
; ===============================

[7003]
type=endpoint
context=from-internal
disallow=all
; === CODECS AUDIO ===
allow=ulaw                ; G.711 µ-law
allow=alaw                ; G.711 A-law
allow=g722                ; G.722 haute qualité
; === CODECS VIDÉO ===
allow=h264                ; H.264/AVC
allow=vp8                 ; VP8
allow=h263                ; H.263
; === PARAMÈTRES VIDÉO ===
max_video_streams=1       ; Un flux vidéo max
max_audio_streams=1       ; Un flux audio max
auth=auth7003
aors=7003

[auth7003]                ; Authentification pour 7003
type=auth
auth_type=userpass
username=7003
password=motdepasse3      ; CHANGEZ ce mot de passe

[7003]                    ; AOR pour 7003
type=aor
max_contacts=1
qualify_frequency=60


; ===============================
; NOTES IMPORTANTES
; ===============================
; 1. Codecs vidéo supportés par Asterisk :
;    - H.264 : Standard moderne, efficace, supporté par la plupart des clients
;    - VP8 : Codec libre, compatible WebRTC
;    - H.263 : Plus ancien, utilisé comme fallback
;
; 2. Pour tester la vidéo :
;    - Les deux softphones doivent supporter le même codec vidéo
;    - Vérifier que les ports RTP sont ouverts (10000-20000/UDP)
;    - Activer la caméra dans le softphone pendant l'appel
;
; 3. Commandes de vérification :
;    - pjsip show endpoints
;    - core show video codecs
;    - rtp show stats
;
; 4. Sécurité :
;    - Changez tous les mots de passe par défaut
;    - Limitez l'accès réseau si nécessaire
;    - Surveillez les logs pour tentatives d'intrusion